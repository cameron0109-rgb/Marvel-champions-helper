<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marvel Champions Solo - Trial</title>
<style>
body { font-family:sans-serif; background:#111; color:#fff; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; }
h1,h2,h3,h4 { margin:5px; }
#game { width:95%; max-width:700px; display:flex; flex-direction:column; align-items:center; }
.area { border:1px solid #fff; border-radius:6px; margin:8px; padding:8px; background:#222; width:100%; }
.flex { display:flex; flex-wrap:wrap; justify-content:flex-start; }
.card { border:1px solid #fff; border-radius:4px; padding:4px; margin:2px; background:#333; width:140px; text-align:center; }
button { margin:4px; padding:6px 10px; border:none; border-radius:4px; background:#f04; color:#fff; font-weight:bold; }
img { border-radius:4px; }
#setup { width:95%; max-width:500px; margin-top:20px; border:1px solid #fff; padding:10px; border-radius:6px; background:#222; }
label, select { margin:5px; }
</style>
</head>
<body>
<h1>Marvel Champions Solo - Trial</h1>

<div id="setup">
  <h2>Game Setup</h2>
  <label>Villain:
    <select id="villainSelect">
      <option value="Rhino">Rhino</option>
      <!-- Add more villains later -->
    </select>
  </label><br>
  <label>Difficulty:
    <select id="difficultySelect">
      <option value="Standard">Standard</option>
      <option value="Expert">Expert</option>
    </select>
  </label><br>
  <label>Include Modular Cards:
    <select id="modularSelect">
      <option value="false">No</option>
      <option value="true">Yes</option>
    </select>
  </label><br>
  <button onclick="startGame()">Start Game</button>
</div>

<div id="game" style="display:none;">
  <!-- Hero Area -->
  <div class="area" id="heroArea">
    <h2>Hero: Spider-Man</h2>
    <div>Health: <span id="heroHP">10</span> | Resources: <span id="heroResources">0</span> | Afflictions: <span id="heroAfflictions">None</span></div>
    <h3>Hand:</h3>
    <div id="heroHand" class="flex"></div>
    <div>Deck: <span id="heroDeckCount">0</span> | Discard: <span id="heroDiscardCount">0</span></div>
    <button onclick="heroDrawCard()">Draw Hero Card</button>
  </div>

  <!-- Villain Area -->
  <div class="area" id="villainArea">
    <h2 id="villainName">Villain: Rhino</h2>
    <div>Health: <span id="villainHP">45</span> | Stage: <span id="villainStage">1</span></div>

    <h3>Main Scheme: <span id="mainSchemeName">The Break-In!</span></h3>
    <div id="mainSchemeText">Rhino tries to steal tech from Oscorp.</div>
    <div>Threat: <span id="mainThreat">0</span> / <span id="mainMaxThreat">6</span></div>
    <button onclick="addThreat()">Add Threat</button>

    <h4>Side Schemes: <span id="sideSchemes">None</span></h4>

    <h3>Minions:</h3>
    <div id="minionArea" class="flex"></div>
    <div>Villain Deck: <span id="villainDeckCount">0</span> | Discard: <span id="villainDiscardCount">0</span></div>
    <button onclick="advanceVillainStage()">Advance Stage</button>
    <button onclick="villainDrawCard()">Draw Villain Card</button>
  </div>
</div>

<script>
// --- Utility ---
function shuffle(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; } }

// --- Game Setup ---
let setup = { villain:null, difficulty:"Standard", modular:false };

// --- Hero ---
let hero = { hp:10, resources:0, hand:[], deck:[], discard:[], afflictions:[], ready:true };
const spiderManDeckFull = [
  {name:"Web-Shooters", cost:1, type:"upgrade", text:"Attack 2. Gain 1 resource.", img:"https://via.placeholder.com/140x200?text=Web-Shooters", effect: ctx=>{ctx.villain.hp-=2; ctx.hero.resources+=1;} },
  {name:"Spider-Sense", cost:0, type:"response", trigger:"afterAttack", text:"After enemy attacks, ready Spider-Man.", img:"https://via.placeholder.com/140x200?text=Spider-Sense", effect: ctx=>{ ctx.hero.ready=true; alert("Spider-Sense triggered!"); } },
  {name:"Enhanced Reflexes", cost:2, type:"upgrade", text:"Evade an enemy.", img:"https://via.placeholder.com/140x200?text=Enhanced+Reflexes", effect: ctx=>{} }
];

// --- Villain ---
let villain = { name:"Rhino", hp:45, stage:1, minions:[], deck:[], discard:[] };
const rhinoStandardCards = [
  {name:"Rhino Charge", type:"attack", text:"Deal 3 damage to hero", img:"https://via.placeholder.com/140x200?text=Rhino+Charge", effect: ctx=>{ ctx.hero.hp-=3; checkResponses("afterAttack"); alert("Rhino attacks for 3 damage!"); } },
  {name:"Spawn Minion", type:"minion", text:"Spawn a minion with 5 HP", img:"https://via.placeholder.com/140x200?text=Spawn+Minion", effect: ctx=>{ spawnMinion(); } },
  {name:"Add Threat", type:"threat", text:"Add 2 threat to main scheme", img:"https://via.placeholder.com/140x200?text=Add+Threat", effect: ctx=>{ addThreat(2); } }
];
const rhinoExpertCards = [
  {name:"Extra Charge", type:"attack", text:"Deal 4 damage", img:"https://via.placeholder.com/140x200?text=Extra+Charge", effect: ctx=>{ ctx.hero.hp-=4; checkResponses("afterAttack"); alert("Rhino expert attack 4!"); } }
];
const rhinoModularCards = [
  {name:"Side Minion", type:"minion", text:"Spawn extra minion", img:"https://via.placeholder.com/140x200?text=Side+Minion", effect: ctx=>{ spawnMinion(); } }
];

// --- Main Scheme ---
let mainScheme = { name:"The Break-In!", text:"Rhino tries to steal tech from Oscorp.", threat:0, maxThreat:6 };

// --- DOM ---
const heroHandDiv = document.getElementById('heroHand');
const heroDeckCount = document.getElementById('heroDeckCount');
const heroDiscardCount = document.getElementById('heroDiscardCount');
const heroHPSpan = document.getElementById('heroHP');
const heroResSpan = document.getElementById('heroResources');
const heroAffSpan = document.getElementById('heroAfflictions');

const villainNameSpan = document.getElementById('villainName');
const villainHPSpan = document.getElementById('villainHP');
const villainStageSpan = document.getElementById('villainStage');
const mainSchemeNameSpan = document.getElementById('mainSchemeName');
const mainSchemeTextDiv = document.getElementById('mainSchemeText');
const mainThreatSpan = document.getElementById('mainThreat');
const mainMaxThreatSpan = document.getElementById('mainMaxThreat');
const minionAreaDiv = document.getElementById('minionArea');
const villainDeckCountSpan = document.getElementById('villainDeckCount');
const villainDiscardCountSpan = document.getElementById('villainDiscardCount');

// --- Hero functions ---
function heroDrawCard(){
  if(hero.deck.length===0){ alert("Hero deck empty!"); return; }
  let card = hero.deck.pop();
  hero.hand.push(card);
  renderHero();
}
function discardForResource(index){
  let card = hero.hand.splice(index,1)[0];
  hero.discard.push(card);
  hero.resources += 1;
  renderHero();
}
function playHeroCard(index){
  let card = hero.hand[index];
  if(card.cost <= hero.resources){
    hero.resources -= card.cost;
    card.effect({hero:hero, villain:villain, mainScheme:mainScheme});
    hero.discard.push(card);
    hero.hand.splice(index,1);
    renderHero();
  } else { alert("Not enough resources!"); }
}
function checkResponses(trigger){
  hero.hand.forEach(c=>{
    if(c.type==="response" && c.trigger===trigger){
      c.effect({hero:hero, villain:villain, mainScheme:mainScheme});
    }
  });
}
function renderHero(){
  heroHandDiv.innerHTML="";
  hero.hand.forEach((c,i)=>{
    let div=document.createElement("div");
    div.className="card";
    div.innerHTML=`<img src="${c.img}" style="width:100%;height:auto;"><b>${c.name} (Cost: ${c.cost})</b><br>${c.text}<br>
      <button onclick="playHeroCard(${i})">Play</button>
      <button onclick="discardForResource(${i})">Discard for Resource</button>
    `;
    heroHandDiv.appendChild(div);
  });
  heroDeckCount.innerText=hero.deck.length;
  heroDiscardCount.innerText=hero.discard.length;
  heroHPSpan.innerText=hero.hp;
  heroResSpan.innerText=hero.resources;
  heroAffSpan.innerText=hero.afflictions.length? hero.afflictions.join(", ") : "None";
}

// --- Villain functions ---
function villainDrawCard(){
  if(villain.deck.length===0){ alert("Villain deck empty!"); return; }
  let card = villain.deck.pop();
  villain.discard.push(card);
  card.effect({hero:hero, villain:villain, mainScheme:mainScheme});
  alert(`Villain drew: ${card.name}`);
  renderVillain();
}
function advanceVillainStage(){ villain.stage++; renderVillain(); }
function spawnMinion(){ let m={hp:5,img:"https://via.placeholder.com/140x200?text=Minion"}; villain.minions.push(m); renderMinions(); }
function renderMinions(){
  minionAreaDiv.innerHTML="";
  villain.minions.forEach((m,i)=>{
    let div=document.createElement("div");
    div.className="card";
    div.innerHTML=`<img src="${m.img}" style="width:100%;height:auto;"><b>Minion ${i+1}</b><br>HP: ${m.hp}`;
    minionAreaDiv.appendChild(div);
  });
}
function addThreat(amount=1){ 
  if(mainScheme.threat + amount <= mainScheme.maxThreat){ 
    mainScheme.threat += amount; 
    mainThreatSpan.innerText = mainScheme.threat; 
  }
}
function renderVillain(){
  villainNameSpan.innerText = "Villain: " + villain.name;
  villainHPSpan.innerText=villain.hp;
  villainStageSpan.innerText=villain.stage;
  mainSchemeNameSpan.innerText = mainScheme.name;
  mainSchemeTextDiv.innerText = mainScheme.text;
  mainThreatSpan.innerText = mainScheme.threat;
  mainMaxThreatSpan.innerText = mainScheme.maxThreat;
  villainDeckCountSpan.innerText = villain.deck.length;
  villainDiscardCountSpan.innerText = villain.discard.length;
  renderMinions();
}

// --- Start Game ---
function startGame(){
  const v = document.getElementById('villainSelect').value;
  const d = document.getElementById('difficultySelect').value;
  const m = document.getElementById('modularSelect').value==="true";
  setup.villain=v; setup.difficulty=d; setup.modular=m;

  // Setup hero
  hero.deck = [...spiderManDeckFull];
  shuffle(hero.deck);
  hero.hand = []; hero.discard=[]; hero.resources=0; hero.hp=10; hero.afflictions=[];

  // Setup villain
  villain.name = v; villain.hp=45; villain.stage=1; villain.minions=[]; villain.discard=[];
  villain.deck = [...rhinoStandardCards];
  if(d==="Expert"){ villain.deck.push(...rhinoExpertCards); }
  if(m){ villain.deck.push(...rhinoModularCards); }
  shuffle(villain.deck);

  // Show game, hide setup
  document.getElementById('setup').style.display="none";
  document.getElementById('game').style.display="flex";

  renderHero();
  renderVillain();
}

</script>
</body>
</html>
