<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marvel Champions Trial: Spider-Man vs Rhino</title>
<style>
  body { font-family: Arial, sans-serif; padding: 10px; background:#f0f0f0;}
  .section { border:1px solid #333; padding:10px; margin:10px 0; background:#fff;}
  .card { border:1px solid #666; padding:5px; margin:5px; background:#eee;}
  .btn { padding:5px 10px; margin:5px; }
  #heroHand { display:flex; flex-wrap:wrap; }
</style>
</head>
<body>
<h1>Marvel Champions: Spider-Man vs Rhino (Trial)</h1>

<div class="section" id="setup">
  <h2>Game Setup</h2>
  <label>Villain difficulty:</label>
  <select id="villainDifficulty">
    <option value="standard">Standard</option>
    <option value="expert">Expert</option>
  </select><br>
  <label>Include Modular Cards:</label><br>
  <input type="checkbox" id="modBomb"> Bomb Scare<br>
  <input type="checkbox" id="modHydra"> Hydra Agents<br>
  <input type="checkbox" id="modBank"> Bank Robbery<br>
  <button class="btn" onclick="startGame()">Start Game</button>
</div>

<div class="section" id="heroArea" style="display:none;">
  <h2>Hero: <span id="heroName">Spider-Man</span></h2>
  <div>Form: <span id="heroForm">Alter-Ego</span> 
      <button class="btn" onclick="toggleHeroForm()">Switch Form</button>
  </div>
  <div>HP: <span id="heroHP">0</span> / <span id="heroMaxHP">0</span></div>
  <div>Abilities:</div>
  <div id="heroAbilities"></div>
  <div>Hand (<span id="heroHandSize">0</span>):</div>
  <div id="heroHand"></div>
  <button class="btn" onclick="heroDrawCard()">Draw Card</button>
</div>

<div class="section" id="villainArea" style="display:none;">
  <h2>Villain: <span id="villainName">Rhino</span></h2>
  <div>Stage: <span id="villainStage">1</span></div>
  <div>Health: <span id="villainHP">0</span></div>
  <div>Deck (<span id="villainDeckSize">0</span>): <button class="btn" onclick="villainDrawCard()">Draw Villain Card</button></div>
  <div id="villainCard"></div>
</div>

<div class="section" id="schemesArea" style="display:none;">
  <h2>Schemes</h2>
  <div>Main Scheme: <span id="mainSchemeName">The Break-In!</span></div>
  <div id="mainSchemeText">Rhino tries to steal tech from Oscorp.</div>
  <div>Threat: <span id="mainThreat">0</span> / <span id="mainMaxThreat">6</span></div>
  <div>Side Schemes:</div>
  <div id="sideSchemes">
    <div>Bomb Scare - Threat: <span id="side1Threat">0</span> / 5</div>
    <div>Hydra Agents - Threat: <span id="side2Threat">0</span> / 4</div>
    <div>Bank Robbery - Threat: <span id="side3Threat">0</span> / 4</div>
  </div>
</div>

<script>
// Utility shuffle
function shuffle(array){ for(let i=array.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; }}

// Hero setup
let hero = {
  name:"Spider-Man",
  currentForm:"alterEgo",
  hp:0,
  maxHP:0,
  hand:[],
  deck:[],
  discard:[],
  forms:{
    alterEgo:{name:"Alter-Ego", maxHP:0, abilities:["Draw 1 card","Gain 1 resource"]},
    hero:{name:"Hero", maxHP:12, abilities:["Attack 3","Play upgrades/allies"]}
  }
};

// Villain setup
let villain = {
  name:"Rhino",
  stage:1,
  hp:22,
  deck:[],
  discard:[]
};

// Main scheme
let mainScheme = {name:"The Break-In!", text:"Rhino tries to steal tech from Oscorp.", threat:0, maxThreat:6,
  advanceEffect:ctx=>{ alert("Main Scheme advanced! Rhino stage increases."); ctx.villain.stage++; ctx.mainScheme.threat=0; renderVillain(); renderSchemes(); }
};

// Side schemes
let sideSchemes = [
  {name:"Bomb Scare", threat:0, maxThreat:5, advanceEffect:ctx=>{ alert("Bomb explodes!"); ctx.sideSchemes[0].threat=0; renderSchemes(); }},
  {name:"Hydra Agents", threat:0, maxThreat:4, advanceEffect:ctx=>{ alert("Hydra agents spawn!"); ctx.sideSchemes[1].threat=0; renderSchemes(); }},
  {name:"Bank Robbery", threat:0, maxThreat:4, advanceEffect:ctx=>{ alert("Bank Robbery triggered!"); ctx.sideSchemes[2].threat=0; renderSchemes(); }}
];

// Example Spider-Man cards (add full core deck later)
let spiderManCards = [
  {name:"Spider-Sense", type:"response", cost:0, trigger:"afterAttack", attack:0, thwart:0, defend:0, text:"After enemy attacks, ready Spider-Man."},
  {name:"Web-Shooters", type:"upgrade", cost:1, attack:2, thwart:0, defend:0, text:"Attack 2 to villain."},
  {name:"Spider-Tracers", type:"upgrade", cost:1, attack:0, thwart:1, defend:0, text:"Thwart 1 to main scheme."}
];

// Example Rhino cards (add full core deck later)
let rhinoCards = [
  {name:"Rhino Charge", type:"attack", attack:3, thwart:0, defend:0, text:"Deal 3 damage to Hero form or add 3 threat if Alter-Ego."},
  {name:"Rhino Stampede", type:"attack", attack:4, thwart:0, defend:0, text:"Deal 4 damage to Hero form or add 4 threat if Alter-Ego."},
  {name:"Minion Recruit", type:"minion", attack:1, thwart:0, defend:0, text:"Spawn 1 minion."}
];

// Start Game
function startGame(){
  // Setup hero
  hero.deck = [...spiderManCards];
  shuffle(hero.deck);
  hero.hand = [];
  hero.discard = [];
  hero.currentForm="alterEgo";
  hero.hp = hero.forms.hero.maxHP;
  hero.maxHP = hero.forms.hero.maxHP;

  // Setup villain
  villain.stage = 1;
  villain.hp = 22;
  villain.deck = [...rhinoCards];
  // Add modular cards if selected
  if(document.getElementById('modBomb').checked) villain.deck.push({name:"Bomb Scare", type:"threat", attack:0, thwart:0, defend:0, text:"Add 1 threat to Bomb Scare"});
  if(document.getElementById('modHydra').checked) villain.deck.push({name:"Hydra Agents", type:"minion", attack:1, thwart:0, defend:0, text:"Add 1 threat to Hydra Agents"});
  if(document.getElementById('modBank').checked) villain.deck.push({name:"Bank Robbery", type:"threat", attack:0, thwart:0, defend:0, text:"Add 1 threat to Bank Robbery"});
  shuffle(villain.deck);
  villain.discard = [];

  // Reset schemes
  mainScheme.threat = 0;
  sideSchemes.forEach(s=>s.threat=0);

  document.getElementById('setup').style.display="none";
  document.getElementById('heroArea').style.display="block";
  document.getElementById('villainArea').style.display="block";
  document.getElementById('schemesArea').style.display="block";

  renderHero();
  renderVillain();
  renderSchemes();
}

// Render Functions
function renderHero(){
  document.getElementById('heroName').innerText = hero.name;
  document.getElementById('heroForm').innerText = hero.forms[hero.currentForm].name;
  if(hero.currentForm==="hero"){
    document.getElementById('heroHP').innerText = hero.hp;
    document.getElementById('heroMaxHP').innerText = hero.maxHP;
  } else {
    document.getElementById('heroHP').innerText = "-";
    document.getElementById('heroMaxHP').innerText = "-";
  }

  let abilitiesHTML = "<ul>";
  hero.forms[hero.currentForm].abilities.forEach(a=>{ abilitiesHTML += `<li>${a}</li>` });
  abilitiesHTML += "</ul>";
  document.getElementById('heroAbilities').innerHTML = abilitiesHTML;

  // Render hand
  let handHTML = "";
  hero.hand.forEach((c,i)=>{ handHTML += `<div class="card">${c.name}<br>${c.text}<br>Atk:${c.attack} Thw:${c.thwart} Def:${c.defend}</div>` });
  document.getElementById('heroHand').innerHTML = handHTML;
  document.getElementById('heroHandSize').innerText = hero.hand.length;
}

function renderVillain(){
  document.getElementById('villainName').innerText = villain.name;
  document.getElementById('villainHP').innerText = villain.hp;
  document.getElementById('villainStage').innerText = villain.stage;
  document.getElementById('villainDeckSize').innerText = villain.deck.length;
}

function renderSchemes(){
  document.getElementById('mainThreat').innerText = mainScheme.threat;
  document.getElementById('mainMaxThreat').innerText = mainScheme.maxThreat;
  sideSchemes.forEach((s,i)=>{
    document.getElementById(`side${i+1}Threat`).innerText = s.threat;
  });
}

// Hero Draw
function heroDrawCard(){
  if(hero.deck.length===0){
    if(hero.discard.length===0){ alert("No cards to draw!"); return; }
    hero.deck = [...hero.discard];
    hero.discard = [];
    shuffle(hero.deck);
    alert("Hero deck reshuffled!");
  }
  hero.hand.push(hero.deck.pop());
  renderHero();
}

// Switch Form
function toggleHeroForm(){
  hero.currentForm = (hero.currentForm==="alterEgo")?"hero":"alterEgo";
  if(hero.currentForm==="hero") hero.hp = hero.forms.hero.maxHP;
  renderHero();
}

// Villain Draw
function villainDrawCard(){
  if(villain.deck.length===0){
    if(villain.discard.length===0){ alert("Villain deck empty!"); return; }
    villain.deck = [...villain.discard];
    villain.discard = [];
    shuffle(villain.deck);
    alert("Villain deck reshuffled!");
  }
  let card = villain.deck.pop();
  villain.discard.push(card);
  document.getElementById('villainCard').innerHTML = `<div class="card">${card.name}<br>${card.text}<br>Atk:${card.attack} Thw:${card.thwart} Def:${card.defend}</div>`;
  // Resolve attack/threat automatically
  if(card.type==="attack"){
    if(hero.currentForm==="hero") hero.hp -= card.attack;
    else addThreat(mainScheme, card.attack);
  }
  if(card.type==="threat") addThreat(mainScheme, card.thwart || 1);
  renderHero();
  renderSchemes();
}

// Add Threat helper
function addThreat(scheme, amount=1){
  scheme.threat += amount;
  if(scheme.threat >= scheme.maxThreat) scheme.advanceEffect({villain:villain, mainScheme:mainScheme, sideSchemes:sideSchemes});
  renderSchemes();
}

</script>
</body>
</html>
